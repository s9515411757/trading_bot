import json
import hmac
import logging
import requests
import time
import datetime as dt
import websocket
import threading
import datetime as dat
import settings

from datetime import datetime

CHAT_ID = settings.CHAT_ID
BYBIT_API_KEY = settings.BYBIT_API_KEY
BYBIT_API_SECRET = settings.BYBIT_API_SECRET


logging.basicConfig(filename='logfile_wrapper.log', level=logging.DEBUG,
                    format='%(asctime)s %(levelname)s %(message)s')

TORGI = {
    '–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏': 0,
    '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏': 0,
    '–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É': False,
    '–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π': 0,
    '–ü–ª–µ—á–æ': 0.1,
    '–î–µ–ø–æ–∑–∏—Ç': 1000,
    '–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏': 10,
    '–ú—ã –≤ —Å–¥–µ–ª–∫–µ': False,
    '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏': 0,
    '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏': 0,
    '–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏': 3,
    '–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç': 1,
    '–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã': 0
}

TORGI_ATR = {
    '–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏': 0,
    '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏': 0,
    '–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É': False,
    '–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π': 0,
    '–ü–ª–µ—á–æ': 0.1,
    '–î–µ–ø–æ–∑–∏—Ç': 1000,
    '–ú—ã –≤ —Å–¥–µ–ª–∫–µ': False,
    '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏': 0,
    '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏': 0,
    '–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏': 75,
    'ATR –Ω–∞ –ø–æ–∫—É–ø–∫—É': 0,
    'ATR –Ω–∞ –ø—Ä–æ–¥–∞–∂—É': 0,
    'ATR': 0
}


usdt = str(input('–í–≤–µ–¥–∏ –≤–∞–ª—é—Ç—É –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ MAGICUSDT: '))
flag_allert_value = int(input('0 - –ù–µ—Ç, 1 - –î–∞. –£–≤–µ–¥–æ–º–ª—è—Ç—å –ø–æ –æ–±—ä–µ–º—É?: '))
if flag_allert_value == 1:
    trigger = float(input('–í–≤–µ–¥–∏ –æ–±—ä–µ–º –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: '))
else:
    trigger = 100

flag_allert = int(input('0 - –ù–µ—Ç, 1 - –î–∞. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π —á–∞—Å –ø–æ —Å—É–º–º–∞—Ä–Ω–æ–º—É –æ–±—ä–µ–º—É: '))
flag_allert_atr = int(input('0 - –ù–µ—Ç, 1 - –î–∞. –í–∫–ª—é—á–∞–µ–º –ê–¢–†: '))
if flag_allert_atr == 1:
    day = int(input('–í–≤–µ–¥–∏ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –æ—Ç—Å—á–∏—Ç—ã–≤–∞–µ–º ATR: '))
else:
    day = 1
flag_bot = int(input('0 - –ù–µ—Ç, 1 - –î–∞. –í–∫–ª—é—á–∞–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é –±–æ—Ç–æ–º –ø–æ –æ–±—ä–µ–º–∞–º?: '))
if flag_bot == 1:
    TORGI['–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã'] = int(input('0 - –ü—Ä–æ—à–ª–∞ –∫—Ä—É–ø–Ω–∞—è –∑–∞—è–≤–∫–∞ –∏ –º—ã –∏–¥—ë–º –≤–º–µ—Å—Ç–µ —Å –Ω–µ–π, 1 - –ü—Ä–æ—à–ª–∞ –∫—Ä—É–ø–Ω–∞—è –∑–∞—è–≤–∫–∞ –∏ –º—ã –∏–¥—ë–º –ø—Ä–æ—Ç–∏–≤ –Ω–µ—ë. –ö–∞–∫—É—é —Ç–æ—Ä–≥–æ–≤—É—é –ª–æ–≥–∏–∫—É –≤—ã–±–∏—Ä–∞–µ–º?: '))
    trigger_bot = float(input('–í–≤–µ–¥–∏ –æ–±—ä–µ–º –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–æ—Ä–≥—É–µ—Ç –±–æ—Ç: '))
    TORGI['–ü–ª–µ—á–æ'] = float(input('–í–≤–µ–¥–∏ –∫–∞–∫–æ–µ –ø–ª–µ—á–æ (0.1 - —ç—Ç–æ 10%): '))
    TORGI['–î–µ–ø–æ–∑–∏—Ç'] = float(input('–í–≤–µ–¥–∏ –∫–∞–∫–æ–π –¥–µ–ø–æ–ª–∑–∏—Ç (–ù–∞–ø—Ä–∏–º–µ—Ä 1000 - —ç—Ç–æ 1000$): '))
else:
    trigger_bot = 100

flag_bot_atr = int(input('0 - –ù–µ—Ç, 1 - –î–∞. –í–∫–ª—é—á–∞–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é –±–æ—Ç–æ–º –ø–æ ATR?: '))
if flag_bot_atr == 1:
    TORGI_ATR['–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã'] = int(input('0 - –ï—Å–ª–∏ ATR  –≤–Ω–∏–∑—É, —Ç–æ –ø–æ–∫—É–ø–∞–µ–º, 1 - –ï—Å–ª–∏ ATR  –≤–Ω–∏–∑—É, —Ç–æ –ø—Ä–æ–¥–∞—ë–º?: '))
    TORGI_ATR['–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏'] = int(input('–ù–∞ –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç ATR –ø–æ–∫—É–ø–∞–µ–º/–ø—Ä–æ–¥–∞–µ–º? (–ü—Ä–∏–º–µ—Ä  75): '))
    day_bot = int(input('–í–≤–µ–¥–∏ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –æ—Ç—Å—á–∏—Ç—ã–≤–∞–µ–º ATR –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏: '))
    TORGI_ATR['–ü–ª–µ—á–æ'] = float(input('–í–≤–µ–¥–∏ –∫–∞–∫–æ–µ –ø–ª–µ—á–æ (0.1 - —ç—Ç–æ 10%): '))
    TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] = float(input('–í–≤–µ–¥–∏ –∫–∞–∫–æ–π –¥–µ–ø–æ–ª–∑–∏—Ç (–ù–∞–ø—Ä–∏–º–µ—Ä 1000 - —ç—Ç–æ 1000$): '))
else:
    trigger_bot_atr = 100


topic = f"publicTrade.{usdt}"


expires = int((time.time() + 1) * 1000)

signature = str(hmac.new(
    bytes(BYBIT_API_SECRET, "utf-8"),
    bytes(f"GET/realtime{expires}", "utf-8"), digestmod="sha256"
).hexdigest())

param = "api_key={api_key}&expires={expires}&signature={signature}".format(
    api_key=BYBIT_API_KEY,
    expires=expires,
    signature=signature
)


def push(text):
    print(f'–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Ç–≥: {text}')
    request = requests.post(
        url='https://api.telegram.org/bot5176992957:AAE6oX7SdfJxGULiO9MS1uEpbviTmLyXxvg/sendmessage',
        data={'chat_id': CHAT_ID, 'text': str(text)}
    )
    if request.status_code != 200:
        print('Error: %s' % request.status_code)


c = True
INFO = {
    '–ø–æ–∫—É–ø–∫–∞': 0,
    '–ø—Ä–æ–¥–∞–∂–∞': 0,
    '–¥–µ–Ω—å –ø–æ–∫—É–ø–∫–∞': 0,
    '–¥–µ–Ω—å –ø—Ä–æ–¥–∞–∂–∞': 0,
}


# S –ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞
# s –í–∞–ª—é—Ç–∞
# v –æ–±—ä–µ–º
# p –¶–µ–Ω–∞
def kline_bot():
    #–Ω—Ç–µ—Ä–≤–∞–ª –ö–ª–∞–π–Ω–∞. 1, 3, 5, 15, 30, 60, 120, 240, 360, 720, D, M, W
    end_ds = int(time.time()*1000)
    start_ds = end_ds - 86400000 * (day_bot + 1)

    url = 'https://api.bybit.com'
    path = '/v5/market/kline'
    URL = url + path
    r = []
    params = {
        'category': 'linear',
        'symbol': usdt,
        'interval': 'D',
        'start': start_ds,
        'end': end_ds,
    }
    f = requests.get(URL, params=params).json().get('result').get('list')
    count = 0
    open_price = 0
    for i in f:
        if count != 0:
            r.append([i[1], i[4]])
        else:
            open_price = float(i[1])
        count += 1

    _list = []
    for i in r:
        result = float(i[0]) - float(i[1])
        if result > 0:
            _list.append(result)
        else:
            _list.append(result * (-1))

    sred = sum(_list) / len(_list)
    new = []
    new1 = []
    for i in _list:
        if i >= sred * 2 or i <= sred / 3:
            new.append(i)
        else:
            new1.append(i)
    if new:
        new_sred = sum(new) / len(new)
    else:
        new_sred = sum(new1) / len(new1)

    TORGI_ATR['ATR –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = round(open_price + new_sred, 7)
    TORGI_ATR['ATR –Ω–∞ –ø—Ä–æ–¥–∞–∂—É'] = round(open_price - new_sred, 7)
    TORGI_ATR['ATR'] = round(new_sred, 7)
    TORGI_ATR['ATR –æ—Ç–∫—Ä—ã—Ç–∞—è —Å–≤–µ—á–∞'] = open_price
    push(f'ATR –¥–ª—è –±–æ—Ç–∞: {str(round(new_sred, 7))}, –º–æ–Ω–µ—Ç—ã: {usdt}, –¥–Ω–∏: {str(day)} \n\n–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ATR: {str(round(open_price + new_sred, 7))}\n–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ATR: {str(round(open_price - new_sred, 7))}')


def kline():
    #–Ω—Ç–µ—Ä–≤–∞–ª –ö–ª–∞–π–Ω–∞. 1, 3, 5, 15, 30, 60, 120, 240, 360, 720, D, M, W
    end_ds = int(time.time()*1000)
    start_ds = end_ds - 86400000 * (day + 1)

    url = 'https://api.bybit.com'
    path = '/v5/market/kline'
    URL = url + path
    r = []
    params = {
        'category': 'linear',
        'symbol': usdt,
        'interval': 'D',
        'start': start_ds,
        'end': end_ds,
    }
    f = requests.get(URL, params=params).json().get('result').get('list')
    count = 0
    open_price = 0
    for i in f:
        if count != 0:
            r.append([i[1], i[4]])
        else:
            open_price = float(i[1])
        count += 1
    _list = []
    for i in r:
        result = float(i[0]) - float(i[1])
        if result > 0:
            _list.append(result)
        else:
            _list.append(result * (-1))

    sred = sum(_list) / len(_list)
    new = []
    new1 = []
    for i in _list:
        if i >= sred * 2 or i <= sred / 3:
            new.append(i)
        else:
            new1.append(i)
    if new:
        new_sred = sum(new) / len(new)
    else:
        new_sred = sum(new1) / len(new1)
    push(f'ATR: {str(round(new_sred, 7))}, –º–æ–Ω–µ—Ç—ã: {usdt}, –¥–Ω–∏: {str(day)} \n\n–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ATR: {str(round(open_price + new_sred, 7))}\n–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ATR: {str(round(open_price - new_sred, 7))}')


def torgi(S, p, v):
    if TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ']:
        if TORGI['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É']:
            if float(p) >= TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] + (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏'] / 100)):
                TORGI['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                PRIBL = (TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(f"‚úÖ –ü—Ä–∏–±—ã–ª—å: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ –≤ –≤—ã–∏—Ä—ã—à–µ, –º—ã –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}")
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = False
                TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False
            if float(p) <= TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] - (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100)):
                TORGI['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                PRIBL = (TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(f"‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n—Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}")
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = False
                TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False
        else:
            if float(p) <= TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏']/100)):
                TORGI['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                PRIBL = (TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']-TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(
                    f"‚úÖ –ü—Ä–∏–±—ã–ª—å: {PRIBL}\n–î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ –≤ –≤—ã–∏—Ä—ã—à–µ, –º—ã –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}")
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False
            if float(p) >= TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] + ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100)) and TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] != 0:
                TORGI['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                PRIBL = (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] - TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']) * TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI['–î–µ–ø–æ–∑–∏—Ç'] -= PRIBL
                push(
                    f"‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à: {PRIBL}\n–î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n—Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}")
                TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False

    else:
        if TORGI['–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã'] == 0:
            if float(v) >= trigger_bot:
                if S == '‚úÖ –ü–æ–∫—É–ø–∫–∞':
                    TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
                    TORGI['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = True
                    TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                    TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI['–î–µ–ø–æ–∑–∏—Ç'] / TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI['–ü–ª–µ—á–æ'])*10
                    OPEN = TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] + (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏'] / 100))
                    CLOSE = TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] - (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100))
                    push(
                        f"‚¨ÜÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}\n{OPEN} = {CLOSE}")
                else:
                    TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
                    TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                    TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI['–î–µ–ø–æ–∑–∏—Ç'] / TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']) * TORGI['–ü–ª–µ—á–æ'])*10
                    OPEN = TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏']/100))
                    CLOSE = TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] + ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100))
                    push(
                        f"‚¨áÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ –∑–∞—à–ª–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –ø–æ —Ü–µ–Ω–µ {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}\n{OPEN} = {CLOSE}")
        else:
            if float(v) >= trigger_bot:
                if S == '‚ùå –ü—Ä–æ–¥–∞–∂–∞':
                    TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
                    TORGI['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = True
                    TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                    TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI['–î–µ–ø–æ–∑–∏—Ç'] / TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI['–ü–ª–µ—á–æ']) * 10
                    OPEN = TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] + (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏'] / 100))
                    CLOSE = TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] - (TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100))
                    push(
                        f"‚¨ÜÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}\n{OPEN} = {CLOSE}")
                else:
                    TORGI['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
                    TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                    TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI['–î–µ–ø–æ–∑–∏—Ç'] / TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']) * TORGI['–ü–ª–µ—á–æ']) * 10
                    OPEN = TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã—à–ª–∏']/100))
                    CLOSE = TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] + ( TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] * (TORGI['–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–æ–ø-–ª–æ—Å—Ç']/100))
                    push(
                        f"‚¨áÔ∏èÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI['–î–µ–ø–æ–∑–∏—Ç']}\n–°–¥–µ–ª–∫–∞ —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}\n–≤–∞–ª—é—Ç–∞: {usdt}\n–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}\n–ü–ª–µ—á–æ: {TORGI['–ü–ª–µ—á–æ']}\n{OPEN} = {CLOSE}")


def torgi_ATR(p):
    if TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ']:
        if TORGI_ATR['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É']:
            if float(p) >= (TORGI_ATR['ATR –æ—Ç–∫—Ä—ã—Ç–∞—è —Å–≤–µ—á–∞'] + ((TORGI_ATR['ATR'] * TORGI_ATR['–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏']) / 100)):
                TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                PRIBL = (TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(f"‚úÖ –ü—Ä–∏–±—ã–ª—å: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | –°–¥–µ–ª–∫–∞ –≤ –≤—ã–∏—Ä—ã—à–µ, –º—ã –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}, —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}, –ü–ª–µ—á–æ: {TORGI_ATR['–ü–ª–µ—á–æ']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI_ATR['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = False
                TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False

            if float(p) <= TORGI_ATR['ATR –Ω–∞ –ø–æ–∫—É–ø–∫—É']:
                TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
                PRIBL = (TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] - TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(f"‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}, —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}, –ü–ª–µ—á–æ: {TORGI_ATR['–ü–ª–µ—á–æ']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI_ATR['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = False
                TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False
        else:
            if float(p) <= (TORGI_ATR['ATR –æ—Ç–∫—Ä—ã—Ç–∞—è —Å–≤–µ—á–∞'] - ((TORGI_ATR['ATR'] * TORGI_ATR['–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏']) / 100)):
                TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                PRIBL = (TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']-TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] += PRIBL
                push(
                    f"‚úÖ –ü—Ä–∏–±—ã–ª—å: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | –°–¥–µ–ª–∫–∞ –≤ –≤—ã–∏—Ä—ã—à–µ, –º—ã –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}, —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}, –ü–ª–µ—á–æ: {TORGI_ATR['–ü–ª–µ—á–æ']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False

            if float(p) >= TORGI_ATR['ATR –Ω–∞ –ø—Ä–æ–¥–∞–∂—É']:
                TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏'] += 1
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
                PRIBL = (TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] - TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']) * TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']
                TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] -= PRIBL
                push(
                    f"‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à: {PRIBL} –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}, —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}, –ü–ª–µ—á–æ: {TORGI_ATR['–ü–ª–µ—á–æ']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")
                TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = 0
                TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = 0
                TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = 0
                TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = False

    else:
        if float(p) <= (TORGI_ATR['ATR –æ—Ç–∫—Ä—ã—Ç–∞—è —Å–≤–µ—á–∞'] - ((TORGI_ATR['ATR'] * TORGI_ATR['–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏']) / 100)):
            TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
            TORGI_ATR['–°–¥–µ–ª–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É'] = True
            TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏'] = float(p)
            TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] / TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']) * TORGI_ATR['–ü–ª–µ—á–æ']) * 10
            push(
                f"‚¨ÜÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | –°–¥–µ–ª–∫–∞ –∑–∞—à–ª–∏ –ø–æ —Ü–µ–Ω–µ {TORGI_ATR['–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']}, –ü–ª–µ—á–æ: {TORGI_ATR['–ü–ª–µ—á–æ']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")
        if float(p) >= (((TORGI_ATR['ATR'] * TORGI_ATR['–ü—Ä–æ—Ü–µ–Ω—Ç —Å–¥–µ–ª–∫–∏']) / 100) + TORGI_ATR['ATR –æ—Ç–∫—Ä—ã—Ç–∞—è —Å–≤–µ—á–∞']):
            TORGI_ATR['–ú—ã –≤ —Å–¥–µ–ª–∫–µ'] = True
            TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'] = float(p)
            TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π'] = float((TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç'] / TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']) * TORGI_ATR['–ü–ª–µ—á–æ']) * 10
            push(
                f"‚¨áÔ∏èÔ∏è –î–µ–ø–æ–∑–∏—Ç: {TORGI_ATR['–î–µ–ø–æ–∑–∏—Ç']} | –°–¥–µ–ª–∫–∞ —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: {TORGI_ATR['–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏']}, –≤–∞–ª—é—Ç–∞: {usdt}, –ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π: {TORGI_ATR['–ö–æ–ª-–≤–æ –∞–∫—Ü–∏–π']} {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–∏–≥—Ä–∞–ª–∏']} = {TORGI_ATR['–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏']}")


def on_message(ws, message):
    global c
    if c:
        push(f'–ó–∞–ø—É—â–µ–Ω. –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –í–∞–ª—é—Ç–∞ - {usdt} | –û–±—ä–µ–º - {trigger}')
        c = False
    message = json.loads(message)
    data = message.get('data')
    if data:
        for i in message['data']:
            T = dt.datetime.fromtimestamp(i['T'] / 1000.0)#–í—Ä–µ–º—è
            S = i['S']#–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞
            s = i['s']#–í–∞–ª—é—Ç–∞
            v = i['v']#–æ–±—ä–µ–º
            p = i['p']#–¶–µ–Ω–∞

            if S == 'Buy':
                S = '‚úÖ –ü–æ–∫—É–ø–∫–∞'
                if flag_allert_value == 1:
                    INFO['–ø–æ–∫—É–ø–∫–∞'] += float(v)
                    INFO['–¥–µ–Ω—å –ø–æ–∫—É–ø–∫–∞'] += float(v)
            else:
                S = '‚ùå –ü—Ä–æ–¥–∞–∂–∞'
                if flag_allert_value == 1:
                    INFO['–ø–æ–∫—É–ø–∫–∞'] += float(v)
                    INFO['–¥–µ–Ω—å –ø–æ–∫—É–ø–∫–∞'] += float(v)

            if float(v) >= trigger and flag_allert_value == 1:
                push(f'{T}, {S}, {s}, {v}, {p}  \n')
            if flag_bot == 1:
                torgi(S, p, v)
            if flag_bot_atr == 1:
                torgi_ATR(p)


def on_error(*error):
    print(error)


def on_close(*ws):
    print("### —Å–æ–±–∏—Ä–∞—é—Å—å –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ ###")


def on_open(ws):
    print('–æ—Ç–∫—Ä—ã—Ç—ã–π')
    ws.send(json.dumps({"op": "subscribe", "args": [topic]}))


def on_pong(ws, *data):
    print('–ø–æ–Ω–≥ –ø–æ–ª—É—á–µ–Ω')


def on_ping(ws, *data):
    now = datetime.now()
    dt_string = now.strftime("%d/%m/%Y %H:%M:%S")
    print("–¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è =", dt_string)
    print('–ø–æ–ª—É—á–µ–Ω –ø–∏–Ω–≥')


def info_orders():
    while True:
        s = dat.datetime.now()
        if s.minute == 59 and s.second in (10, 11, 12, 13, 14, 15) and flag_allert_atr == 1:
            push(f"–ó–∞ —á–∞—Å –Ω–∞ –≤–∞–ª—é—Ç–µ {usdt}: ‚úÖ {str(INFO['–ø–æ–∫—É–ø–∫–∞'])} | ‚ùå {str(INFO['–ø—Ä–æ–¥–∞–∂–∞'])}")
            INFO['–ø–æ–∫—É–ø–∫–∞'] = 0
            INFO['–ø—Ä–æ–¥–∞–∂–∞'] = 0
            time.sleep(60)
        if s.hour == 23 and s.minute == 10  and s.second in (10, 11, 12, 13, 14, 15):
            push(f"–ó–∞ —Å—É—Ç–∫–∏ –Ω–∞ –≤–∞–ª—é—Ç–µ {usdt}: ‚úÖ {str(INFO['–¥–µ–Ω—å –ø–æ–∫—É–ø–∫–∞'])} | ‚ùå {str(INFO['–¥–µ–Ω—å –ø—Ä–æ–¥–∞–∂–∞'])}")
            INFO['–¥–µ–Ω—å –ø–æ–∫—É–ø–∫–∞'] = 0
            INFO['–¥–µ–Ω—å –ø—Ä–æ–¥–∞–∂–∞'] = 0
            time.sleep(60)
        time.sleep(30)


def connWS():
    ws = websocket.WebSocketApp(
        "wss://stream.bybit.com/v5/public/linear" + "?" + param,
        on_message=on_message,
        on_error=on_error,
        on_close=on_close,
        on_ping=on_ping,
        on_pong=on_pong,
        on_open=on_open
    )

    ws.run_forever(
        ping_interval=20,
        ping_timeout=10
    )


if __name__ == "__main__":
    # while True:
    #     try:
    #         t1 = threading.Thread(target=info_orders)
    #         t1.start()
    #         if flag_allert_atr == 1:
    #             t2 = threading.Thread(target=kline)
    #             t2.start()
    #         if flag_bot_atr == 1:
    #             t3 = threading.Thread(target=kline_bot)
    #             t3.start()
    #         connWS()
    #     except Exception as ex:
    #         print(ex)
    #     finally:
    #         print(f'üíä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –º–æ–Ω–µ—Ç—ã {usdt}')
    t1 = threading.Thread(target=info_orders)
    t1.start()
    if flag_allert_atr == 1:
        t2 = threading.Thread(target=kline)
        t2.start()
    if flag_bot_atr == 1:
        t3 = threading.Thread(target=kline_bot)
        t3.start()
    connWS()